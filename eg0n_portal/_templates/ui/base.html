{% load i18n static %}
{% get_current_language as LANGUAGE_CODE %}{% get_current_language_bidi as LANGUAGE_BIDI %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:"en-us" }}" dir="{{ LANGUAGE_BIDI|yesno:'rtl,ltr,auto' }}">

<head>
    <link rel="author" href="https://www.adainese.it" />
    <link rel="icon" href="{% static 'ui/favicon.ico' %}" type="image/x-icon" sizes="16x16" />
    <title>{% block title %}eg0n{% endblock title %}</title>
    <meta charSet="utf-8" />
    <meta name="author" content="Andrea Dainese, Rocco Sicilia" />
    <meta name="description" content="eg0n.">
    <meta name="keywords" content="eg0n, misp, cti">
    <meta name="Content-Security-Policy"
        content="default-src 'none'; script-src 'self'; connect-src 'self'; img-src 'self'; style-src 'self';base-uri 'self';form-action 'self'" />
    <meta name="robots" content="noindex, nofollow">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <!-- CSS files -->
    <link href="{% static 'tabler/css/tabler.min.css' %}" rel="stylesheet" />
    <link href="{% static 'ui/css/main.css' %}" rel="stylesheet" />
</head>

<body class="{% block bodyclass %}{% endblock bodyclass %}">
    <!-- VIEW: {{ request.resolver_match.view_name }} -->
    <!-- Banner -->
    {% block banner %}
    {% if messages %}
    <ul>
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endblock banner %}
    {% block navbar %}
    <!-- Navbar -->
    {% include "ui/partials/navbar.html" %}
    {% endblock navbar %}
    <div class="{% block pageclass %}page{% endblock pageclass %}">
        {% block page %}
        <div class="page-wrapper">
            <!-- Body -->
            {% block body %}
            {% block page_header %}
            <div class="page-header d-print-none" aria-label="Page header">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">{% block page_title %}{% endblock page_title %}</h2>
                        </div>
                    </div>
                </div>
            </div>
            {% endblock page_header %}
            <div class="page-body">
                <div class="container-xl">
                    <div class="row row-cards">
                        {% block page_body %}{% endblock page_body %}
                    </div>
                </div>
            </div>
            {% endblock body %}
            <!-- Footer -->
            {% block footer %}
            {% include "ui/partials/footer.html" %}
            {% endblock footer %}
        </div>
        {% endblock page %}
    </div>
    <!-- JavaScript files -->
    <script src="{% static 'tabler/js/tabler.min.js' %}" defer></script>
    <script src="{% static 'alpinejs/js/alpinejs.min.js' %}" defer></script>
    <script>
        /**
        * This script enables closing Bootstrap dropdowns by clicking on a close button inside them.
        * It supports multiple dropdowns on the same page and ensures that only the correct dropdown is closed.
        *
        * Usage requirements:
        * - Each dropdown toggle must have the attribute: data-bs-toggle="dropdown"
        * - Each close button must have the attribute: data-bs-dismiss="dropdown"
        * - The close button must be inside a .dropdown container
        */

        document.addEventListener("DOMContentLoaded", function () {
            // Select all close buttons that should dismiss a dropdown
            const closeButtons = document.querySelectorAll('.btn[data-bs-dismiss="dropdown"]');

            closeButtons.forEach(closeBtn => {
                closeBtn.addEventListener("click", function () {
                    // Find the nearest parent dropdown container
                    const dropdown = closeBtn.closest(".dropdown");

                    if (!dropdown) return; // Exit if no dropdown parent is found

                    // Find the toggle element that controls this dropdown (usually an <a> with data-bs-toggle)
                    const toggle = dropdown.querySelector('[data-bs-toggle="dropdown"]');

                    if (!toggle) return; // Exit if toggle is not found

                    // Get the Bootstrap Dropdown instance or create one if it doesn't exist
                    const dropdownInstance = bootstrap.Dropdown.getOrCreateInstance(toggle);

                    // Programmatically hide the dropdown
                    dropdownInstance.hide();
                });
            });
        });
    </script>
</body>

</html>
